# èŠå¤©å®¤é¡¹ç›®æ–‡æ¡£



# å‚è€ƒè§†é¢‘

è‡ªå·±ä»å¤´å¼€å§‹åšï¼Œå®Œå…¨æ²¡å¤´ç»ªï¼Œå°±å‚è€ƒäº†ä»¥ä¸‹è§†é¢‘ã€‚



- [x] [Nodeå‰åç«¯äº¤äº’,åŒ…å«é¡¹ç›®å®æˆ˜](https://www.bilibili.com/video/BV1j5411K7EH?p=255)
- [x] [éƒ½å‰åç«¯åˆ†ç¦»äº†ï¼Œå’±å°±åˆ«è¿”å›é¡µé¢äº†ï¼Œç»Ÿç»Ÿ JSON äº¤äº’](https://www.bilibili.com/video/BV1np4y1C7v5?spm_id_from=333.880.my_history.page.click)
- [ ] [ã€åŠå°æ—¶å¸¦ä½ æå®šAjaxã€‘æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ä½¿ç”¨Ajaxå‘é€è¯·æ±‚ï¼Œå®ç°å‰åç«¯äº¤äº’](https://www.bilibili.com/video/BV18y4y1L73h?p=2)
- [ ] [ã€JavaWeb+JAVAåå°é¡¹ç›®å®æˆ˜ã€‘Crmåå°ç®¡ç†ç³»ç»Ÿé¡¹ç›®å®æˆ˜-Spring](https://www.bilibili.com/video/BV17o4y1R789?p=181)
- [ ] [WebSocketæ‰“é€ åœ¨çº¿èŠå¤©å®¤](https://www.bilibili.com/video/BV1r54y1D72U?p=2)
- [ ] [SpringBoot+Vueå‰åç«¯åˆ†ç¦»é¡¹ç›®](https://www.bilibili.com/video/BV1wY411J7X8?p=9)
- [ ] [å°šç¡…è°·é›·ç¥SpringBoot2é›¶åŸºç¡€å…¥é—¨](https://www.bilibili.com/video/BV19K4y1L7MT?p=19)
- [ ] [ä»0å¼€å§‹å¸¦ä½ æ‰‹æ’¸ä¸€å¥—SpringBoot+Vueåå°ç®¡ç†ç³»ç»Ÿ](https://www.bilibili.com/video/BV1U44y1W77D?p=5)
- [ ] [å°šç¡…è°·æœ€æ–°ç‰ˆJavaWebå…¨å¥—æ•™ç¨‹,java webé›¶åŸºç¡€å…¥é—¨å®Œæ•´ç‰ˆ](https://www.bilibili.com/video/BV1Y7411K7zz?p=160)
- [x] [å‰åç«¯åˆ†ç¦»ï¼ŒGETã€POSTæ¥å£ï¼ŒJSONè¿”å›](https://www.bilibili.com/video/BV1NP4y1W7n4/?spm_id_from=333.788.recommend_more_video.0)
- [x] [æ‰‹æŠŠæ‰‹æ•™ä½ å†™java webå’Œæ¥å£](https://www.bilibili.com/video/BV16541147s1/?spm_id_from=333.788.recommend_more_video.-1)
- [x] [Springbootæç®€å…¥é—¨æ•™ç¨‹ï¼Œ5åˆ†é’Ÿå†™ä¸€ä¸ªhttpæ¥å£](https://www.bilibili.com/video/BV1Bq4y1j7Zz/?spm_id_from=333.788.recommend_more_video.-1) 
- [ ] [12åˆ†é’Ÿæå®šåŸºäºwebsocketï¼Œspringbootï¼Œvueçš„ç®€å•èŠå¤©å®¤ã€‚](https://www.bilibili.com/read/cv16430929?spm_id_from=333.999.0.0)
- [ ] [å²ä¸Šæœ€ç®€å•çš„spring-booté›†æˆwebsocketçš„å®ç°æ–¹å¼](https://www.bilibili.com/video/BV1Bf4y1R7fS?spm_id_from=333.337.search-card.all.click)
- [ ] [å³æ—¶èŠå¤©ç³»ç»Ÿ(OICQ)åŸºäºspringboot mybatis vue websocket](https://www.bilibili.com/video/BV1XT4y1i71M?spm_id_from=333.337.search-card.all.click)
- [ ] [SpringBooté›†æˆWebSocketå®ç°ç½‘é¡µèŠå¤©ï¼ˆå½•æ’­ï¼‰ ](https://www.bilibili.com/video/BV12Q4y1q7VP?spm_id_from=333.337.search-card.all.click) â­â­â­â­â­ ç®€æ´æœ‰æ•ˆ
- [ ] [SpringBoot+Vueåœ¨çº¿èŠå¤©ç³»ç»Ÿ](https://www.bilibili.com/video/BV1N94y1d7tr?p=4) æºç æ”¶è´¹ã€å¯ä»¥çœ‹çœ‹è§†é¢‘
- [x] [SpringBoot+Netty+WebSocketå®ç°åœ¨çº¿èŠå¤©](https://www.bilibili.com/video/BV1WB4y1N7Sj/?spm_id_from=333.788.recommend_more_video.2&vd_source=07d933cd4c64b259f09ced00e89ac8a9) ä¸»è¦æ˜¯æ•´åˆäº†`Netty`

#  å‚è€ƒè´¦å·

[ä¹å­—èŠ‚](https://space.bilibili.com/1001395107)

[é»‘é©¬ç¨‹åºå‘˜å¹¿å·ä¸­å¿ƒ](https://space.bilibili.com/429854910)

[ä¹å­—èŠ‚-å˜Ÿå˜Ÿ](https://space.bilibili.com/1001395107)

[SpringBoot æ•´åˆå„ç§æ¡†æ¶ ](https://space.bilibili.com/325883425)

[åšä¸€æ¡æœ‰æ¢¦æƒ³çš„å’¸é±¼132]( https://www.bilibili.com/read/cv16430929?spm_id_from=333.999.0.0 )

## å‚è€ƒé¡¹ç›®

https://gitee.com/june000/lemon-im

https://gitee.com/howcode/has-chat

https://gitee.com/make-a-dream/chat-demo.git 

#  é¡¹ç›®å·¥ç¨‹ç»“æ„

ç»è¿‡æŠ€æœ¯é€‰å‹ï¼Œæœ€åå†³å®šé‡‡ç”¨SpringBootæ•´åˆMyBatisã€MySqlæ•°æ®åº“

IDEAå·¥ç¨‹ä¹Ÿæ˜¯å¤ä¹ äº†å¾ˆå¤šæ­¤å‰çš„è§†é¢‘ï¼Œç¨³ä¹‹åˆç¨³ï¼Œåˆ›å»ºSpringBootå·¥ç¨‹ã€‚

[JavaWebå·¥ç¨‹ç»“æ„è§£æå›¾](https://segmentfault.com/a/1190000022110134)

[Javawebé¡¹ç›®ç›®å½•ç»“æ„è§£æ(åŸºäºIDEA)](https://blog.csdn.net/huzia/article/details/124044137)



#  é¡¹ç›®æ•´ä½“ è°ƒç”¨é€»è¾‘

è™½ç„¶å»ºç«‹å¥½äº†æ•´ä¸ªé¡¹ç›®çš„ç»“æ„ï¼Œä½†æ˜¯æ•´ä½“é€»è¾‘æ¶æ„è¿˜æ˜¯éœ€è¦è‡ªå·±ç†ä¸€éçš„ï¼Œå°¤å…¶æ˜¯æœ‰çš„åŒ…/ç»“æ„ å…¶å®åç§°å«æ³•ä¸ä¸€æ ·ï¼Œåˆæˆ–è€…è¯´å¯ä»¥æ›´åŠ ç»†åŒ–åŒºåˆ†ã€‚

æ¯”å¦‚ï¼šä¸€ä¸ªå®ä½“ç±»å¯ä»¥æ˜¯`bean` /`entity`/`pojo` ç­‰ç­‰ ä½†å…¶å®åˆå¯ä»¥ç»†åˆ†ä¸º`DTO` `PO` `VO` ç­‰ç­‰ã€`dao`å±‚ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º`mapper`å±‚



##  DTO/VO/PO/VO å„ç§å¯¹è±¡

å…¶å®ä¸æ˜¯åªæœ‰`bean` è¿™ä¸€å•ä¸€çš„å®ä½“ç±»ï¼Œæ›´åŠ ç»†åŒ–çš„è¯è¿˜æœ‰é¢å‘å„ç§å„æ ·çš„Object

##  VOå±‚ä¸è¦å’Œæ•°æ®åº“çš„ç»‘å®š

ä¹‹å‰ä¸€ç›´å¾ˆçº ç»“ï¼Œæœ‰äº›è¿”å›ç»™å‰ç«¯çš„`json` å¦‚ä½•ä¸æ•°æ®åº“å­—æ®µç»‘å®š

åæ¥å‘ç°è‡ªå·±çŠ¯äº†ä¸ªé”™ï¼šä»¥ä¸ºæ‰€æœ‰`Bean`éƒ½ç›´æ¥å’Œæ•°æ®åº“ç»‘å®š

ç„¶è€Œå°±ä¸æ˜¯è¿™æ ·çš„

##  æ¯”å¦‚xxxGroupç±»

åœ¨å‰ç«¯è¦æ±‚çš„`markdown`æ–‡ä»¶ä¸­ï¼Œæœ‰ `controlGroups`  `joinGroups` ä¸¤ç§ç±»å‹

è¿™ä¸ªå…¶å®å°±æ˜¯ä¸€ä¸ªäººæ‰€åœ¨çš„ç¾¤èŠï¼Œè™½ç„¶åå­—ä¸åŒï¼Œä½†æ˜¯æœ¬è´¨å°±æ˜¯åŒä¸€å¥—å±æ€§ å°±æ˜¯`Type`å±æ€§ä¸åŒ

å·®ç‚¹ä¸€è‚¡è„‘åˆåˆ†æˆä¸¤ä¸ªç±»ã€‚

# HelloWorld

2022.5.12çš„23ç‚¹å¼€å§‹ æ€»ç®—æ˜¯æŠŠé¡¹ç›®å»ºèµ·æ¥äº†

2022.5.15 å‘¨æ—¥ä¸‹åˆè¿‡æ¥ç®€å•é…ç½®äº†ä¸€ä¸‹ã€‚

å¯åŠ¨çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå°æ’æ›²ï¼š

> ***************************
> APPLICATION FAILED TO START
> ***************************
>
> Description:
>
> Failed to configure a DataSource: 'url' attribute is not specified and no embedded datasource could be configured.
>
> Reason: Failed to determine a suitable driver class
>
>
> Action:
>
> Consider the following:
> 	If you want an embedded database (H2, HSQL or Derby), please put it on the classpath.
> 	If you have database settings to be loaded from a particular profile you may need to activate it (no profiles are currently active).
>
>
> Process finished with exit code 1

è¿™é‡ŒæŠ¥é”™äº†ï¼Œå…¶å®æ„æ€å°±æ˜¯ æˆ‘æƒ³ç”¨æ•°æ®åº“ï¼Œä½†æ˜¯åˆæ²¡æœ‰é…ç½®å¥½ï¼Œæ‰€ä»¥æ‰¾ä¸åˆ°æ•°æ®åº“ã€‚ 

ç´¢æ€§å°±ç›´æ¥é…ç½®äº†æ•°æ®åº“é“¾æ¥çš„åœ°å€ï¼Œåœ¨`resources`æ–‡ä»¶å¤¹ä¸‹é¢çš„	`application.properties`é‡Œé¢ç»Ÿä¸€é…ç½®ã€‚æ ¼å¼å¦‚ä¸‹ï¼š

> spring.datasource.driver-class-name= com.mysql.jdbc.Driver
>
> spring.datasource.url=
>
> spring.datasource.username=root
>
> spring.datasource.password=



# æ¥å£æ–‡æ¡£ç¼–å†™

ä»Šå¤© 2022.5.16 è¢«å‚¬ç€å†™æ¥å£æ–‡æ¡£äº†ï¼Œä¹‹å‰éƒ½ä»¥ä¸ºæ¥å£æ–‡æ¡£å¿…é¡»è¦ç”¨æŸç§æ–‡ä»¶æ ¼å¼ï¼Œå…¶å®å°±æ˜¯ä¸€ä»½æ–‡æ¡£ã€‚docxã€markdownéƒ½è¡Œ

## æ¥å£æµ‹è¯•

2022.5.17 

ä¸‹åˆ è·Ÿç€[5åˆ†é’Ÿå†™ä¸€ä¸ªhttpæ¥å£](https://www.bilibili.com/video/BV1Bq4y1j7Zz/?spm_id_from=333.788.recommend_more_video.-1) åšäº†ä¸ªç®€å•çš„æ¥å£æµ‹è¯•ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œä½†æ˜¯åšäº†å¾ˆä¹…å› ä¸ºå¤ä¹ äº†`@PostMapping`	`@RequestMapping` è¿™ç§æ³¨è§£

è¿˜æœ‰`Mapper` `bean` `Controller` è¿™ç§åˆ†å±‚é€»è¾‘

```java
public interface UserMapper {
    @Select("SELECT * FROM usersinfo")
    List<User> findAll();
}
```

```java
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
public class User {
    public String Username;
    public String Password;
    public String Phone;
    public String Nickname;
    public String Address;
    public String Slogan;
    public String Birthday;
    public String Job;
}
```

æŠ¥é”™

> Description:
>
> A component required a bean of type 'com.chatroom.chatroom.mapper.UserMapper' that could not be found.

æœ€åå¯åŠ¨å‘ç°ï¼Œå‹æ ¹å°±æ²¡æœ‰æŠŠ	`UserMapper` ç±»äº¤ç»™Springå®¹å™¨ç®¡ç†ï¼ˆéƒ½å¿«å¿˜å…‰äº†ï¼‰ å°±å¼•å…¥ä¾èµ–

```java
<dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.1.3</version>
 </dependency>
```

å¹¶ä¸”åœ¨å¯åŠ¨ç±» åŠ ä¸Š`@MapperScan("com.chatroom.chatroom.mapper")`

## PostMapping ä½¿ç”¨é”™è¯¯

```java
@GetMapping("/testGetUser")
    public List<User> getUser(){
        return userMapper.findAll();
    }
```

è¿™é‡Œæœ¬æ¥æƒ³ç”¨`@PostMapping` çš„ï¼Œä½†æ˜¯å¤ä¹ å¾—çŸ¥å…¶å®ä»æµè§ˆå™¨çš„è§’åº¦å‹æ ¹ä¸èƒ½ï¼Œæˆ–è€…è¯´ å‹æ ¹å°±ä¸æ˜¯ç»™æ™®é€šç”¨æˆ·å‡†å¤‡çš„ã€‚

Postman æ˜¯å¯ä»¥è®¿é—®çš„

## å…³äºUserBeançš„lombokæ³¨è§£ å°æ’æ›²

çœ‹è§†é¢‘çš„æ—¶å€™ç›´æ¥ç»™`User`ç±» æ— è„‘åŠ äº†`@Data` æ³¨è§£

![image-20220517171812619](../JavaAllNotesResources/MyNotes/images/image-20220517171812619-16527790935101.png)

ç»“æœæµè§ˆå™¨ç›´æ¥ç»™è¿™æ ·äº†

![image-20220517171909134](../JavaAllNotesResources/MyNotes/images/image-20220517171909134-16527791502535.png)

è‡ªå·±çœ‹é¦–å­—æ¯éƒ½å°å†™äº†ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯å±æ€§åé¦–å­—æ¯å°å†™å˜æˆ æœ‰å‚æ„é€ å®ä¾‹å˜é‡ äº†ï¼Œèµ¶ç´§å»é™¤äº†`@Data`æ³¨é‡Šï¼Œä¹‹åæ­£å¸¸äº†ã€‚è¿™æ˜¯æ­£å¸¸çš„é¡µé¢æ˜¾ç¤º`json` æ•°æ®

![image-20220517171834231](../JavaAllNotesResources/MyNotes/images/image-20220517171834231-16527791151683.png)



## åˆæ‰«æä¸åˆ°Bean å´©äº† åˆ·æ–°mavenå¥½äº†

æ™šä¸Šåƒäº†ä¸ªé¥­å›æ¥ï¼ŒåˆæŠ¥é”™æ‰¾ä¸åˆ°beanï¼Œå’Œä¸‹åˆä¸€æ¨¡ä¸€æ ·äº†ã€‚

```<dependency>
<dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.1.3</version>
 </dependency>
```

å› ä¸º`@Mapper` æ˜¯åœ¨è¿™ä¸ªåŒ…é‡Œï¼Œæ‰€ä»¥`maven` é‡æ–°åˆ·æ–°å¯¼å…¥äº†ä¸€ä¸‹å°±å¥½äº†

é‡ç‚¹æ˜¯ï¼Œä¸­é—´å°±æŠŠç”µè„‘å¸¦å‡ºå®éªŒå®¤äº†ä¸€ä¸‹ï¼ˆå½“å¤©å­¦æ ¡ç½‘ä¸å¥½+ç¡®å®åˆ‡æ¢äº†ç½‘ç»œï¼‰ï¼Œå…¶ä»–å•¥ä¹Ÿæ²¡æ”¹ã€‚ä¸çŸ¥é“æ€ä¹ˆå°±è¿™äº†ã€‚



# è·¨åŸŸé—®é¢˜

(ä»€ä¹ˆæ˜¯è·¨åŸŸä»¥åŠå¦‚ä½•è§£å†³ï¼Ÿé€šä¿—æ˜“æ‡‚å¸¦ä½ å½»åº•æå®š)[https://www.bilibili.com/video/BV12U4y1f7Qi/?spm_id_from=333.788.recommend_more_video.7]

## åŒæºç­–ç•¥



## åå°è§£å†³æ–¹æ³•ï¼šCORS

Corss Origin Resource Sharing 

1. ç›´æ¥åœ¨æ–¹æ³•ä¸Šé¢åŠ ä¸€ä¸ª`@CrossOrigin` 

2. æ·»åŠ è¿‡æ»¤å™¨ï¼Œè‡ªå·±è®¾ç½®ä¸€ä¸ªå®šä¹‰ç±»

   ```java
   package com.chatroom.chatroom.configuration;
   
   import org.springframework.context.annotation.Bean;
   import org.springframework.context.annotation.Configuration;
   import org.springframework.web.cors.CorsConfiguration;
   import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
   import org.springframework.web.filter.CorsFilter;
   //è¿™é‡Œçœ‹æ¸…æ¥šï¼ŒCorsFliter å¦ä¸€ä¸ªåŒ…é‡Œé¢ä¹Ÿæœ‰ï¼Œåˆ«å¯¼å…¥é”™è¯¯äº†
   
   @Configuration
   public class CorsConfig {
       /**
        * è¿™æ˜¯ä¸“é—¨ç”¨äºè§£å†³è·¨åŸŸé—®é¢˜çš„Corsé…ç½®ç±»
        * @return
        */
       @Bean
       public CorsFilter corsFilter(){
           CorsConfiguration corsConfiguration = new CorsConfiguration();
           /**
            * æœ¬è´¨ä¸Šå°±æ˜¯è¿‡æ»¤å™¨
            * è®¾ç½®ç™½åå•
            * */
           corsConfiguration.addAllowedOrigin("*");//è®¾ç½®é€šé…ç¬¦ï¼Œå…è®¸æ‰€æœ‰çš„åŸŸæ¥è¯·æ±‚
           corsConfiguration.addAllowedHeader("*");
           corsConfiguration.addAllowedMethod("*");
   
           UrlBasedCorsConfigurationSource source=new UrlBasedCorsConfigurationSource();
           source.registerCorsConfiguration("/**",corsConfiguration);
   
           return new CorsFilter(source);
       }
   }
   
   ```

3. å®ç°`WebMvcConfigure`æ¥å£ï¼Œé‡å†™`addCorsMappings`

   ```java
   @Configuration
   public class CorsConfiguration implements WebMvcConfigurer{
       @Override
       public void addCorsMappings(CorsRegistry registry) {
           registry.addMapping("/**")
                   .allowedOriginPatterns("*")
                   .allowCredentials(true)
                   .allowedMethods("GET", "POST", "DELETE", "PUT")
                   .maxAge(3600);
       }
   }
   ```

   

# å›¾ç‰‡å¤´åƒä¸Šä¼ é—®é¢˜

å…³é”®é—®é¢˜åœ¨äºï¼šå¦‚ä½•æŠŠå¤´åƒå­˜å…¥æ•°æ®åº“ï¼Ÿ

ä¸€å¼€å§‹æˆ‘æ˜¯æƒ³çš„ï¼šæŠŠå¤´åƒæ–‡ä»¶çš„è·¯å¾„æ”¾å…¥æ•°æ®åº“ï¼Œæ ¹æ®è·å–çš„åœ°å€å†å»å¯¹åº”æ–‡ä»¶è·¯å¾„è·å–å›¾ç‰‡ã€‚è¿™æ ·çš„ç¡®ç§‘å­¦æœ‰æ•ˆï¼ŒèŠ‚çº¦æ•°æ®åº“çš„ç©ºé—´ã€‚ä½†æ˜¯è€ƒè™‘åˆ°ï¼Œé¡¹ç›®æœ¬èº«æ˜¯å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨`MediumBlob` äºŒè¿›åˆ¶å¤§æ–‡ä»¶å­˜å‚¨äº†ï¼Œ`MediumBlob`æœ€å¤§16Mï¼Œç»å¯¹å¯ä»¥æ»¡è¶³å¤´åƒä¸Šä¼ éœ€æ±‚äº†ã€‚



#  é›†æˆMyBatis

## æ³¨è§£å¼€å‘

```mysql
@Select("SELECT * FROM usersinfo")
List<User> findAll();
```

æ–¹ä¾¿å¿«æ·ï¼Œä½†æ˜¯æœ‰ä¸€å®šç¼ºé™·

# é…ç½®å¼€å‘

åœ¨`User.xml` æ–‡ä»¶é‡Œé¢å†™å¥½é…ç½®

```java
<mapper namespace="com.chatroom.chatroom.mapper.UserMapper">
    //ç±»çš„å…¨è·¯å¾„åå­—
    <update id="updateInfo">//idæ˜¯å‡½æ•°å
       update xxxx
    </update>
</mapper>
```

#  ç†Ÿæ‚‰å„ç§æ³¨è§£çš„æ„æ€

å¼€å§‹ç¼–å†™å†…å®¹å‘ç°ï¼ŒSpringBootæ¡†æ¶çš„æ³¨è§£æå…¶å¼Šä¾¿æ·+é‡è¦

æ‰€ä»¥åœ¨æ­¤ä¹‹å‰ï¼Œåº”è¯¥èµ¶ç´§ç†Ÿæ‚‰èµ·SpringBootçš„å„ç§å¼€å‘æ³¨è§£



##  MyBatis Plusä½¿ç”¨



#  æ•°æ®åº“

Mysqlçš„å»ºè¡¨å…¶å®ä¹Ÿæ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ ¹æ®éœ€æ±‚å»ºè¡¨å‘ç°å¾ˆå¤šä¸œè¥¿éƒ½ä¸æ‡‚

![img](../JavaAllNotesResources/MyNotes/images/0KMESVV2BQDMNEC5HOOSESF-16530208471922.png)

æ¯”å¦‚ï¼š`json` å’Œ`javaBean` çš„äº’ç›¸è½¬æ¢ 

- Gson
- FastJson
- Jackson

è¿™äº›éƒ½å¯ä»¥è½¬æ¢ã€‚

ä¿è¯ **å­—æ®µ** å’Œ **Beanå±æ€§**çš„å¯¹åº”ï¼Œå°±å¯ä»¥å°è£…æˆ**å¯¹è±¡**

æ‰€ä»¥å›¾ä¸­çš„åµŒå¥—`Json` å°±å¯ä»¥æ­£å¥½ä»¥é¢å‘å¯¹è±¡æ–¹å¼åµŒå¥—



##  æ•°æ®åµŒå¥—

æœ‰æ—¶å€™åµŒå¥—å±‚æ•°æœ‰ç‚¹å¤šï¼Œä¸å¦‚æŠŠæœ¬èº«æ˜¯ä¹Ÿæœ‰å¯¹è±¡çš„éƒ½æŠ½å‡ºæ¥ï¼Œå…¶ä»–çš„é›¶æ•£çš„å±æ€§ç»„æˆä¸€ä¸ªå¯¹è±¡ã€‚æœ€åå‡ ä¸ªå¯¹è±¡åœ¨åå°ç»„è£…ã€‚ ä¸ç„¶çš„è¯

## å»ºè¡¨

è€Œåœ¨æ•°æ®åº“ ä¸€ä¸ª`json` å°±å¯ä»¥å¯¹åº”ä¸€ä¸ªè¡¨ï¼Œç„¶åä¸€ä¸ªè¡¨æŸ¥å‡ºæ¥çš„å°å¯¹è±¡

å½“å¤§å¯¹è±¡çš„å±æ€§å¡«å……è¿›å»ï¼Œæœ€åå¤§å¯¹è±¡ è½¬æ¢æˆ`json`



## å‘½åè§„èŒƒ

æ•°æ®åº“å­—æ®µ ä¸èƒ½å’Œå†…ç½®çš„å…³é”®è¯é‡å

`message`è¡¨é‡Œé¢çš„ `Date` `Timestamp` å¾ˆæ˜æ˜¾é‡åäº†ï¼Œæ‰€ä»¥å°±æŠ¥é”™

> org.springframework.jdbc.BadSqlGrammarException: 
> ### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'system,saved,distributed,seen,deleted,failure,disable_actions,disable_reactions,' at line 1
> ### The error may exist in com/chatroom/chatroom/mapper/MessageMapper.java (best guess)
> ### The error may involve defaultParameterMap
> ### The error occurred while setting parameters
> ### SQL: SELECT  _id,index_id,content,username,room_id,sender_id,avatar,date,timestamp,system,saved,distributed,seen,deleted,failure,disable_actions,disable_reactions,reactions,files,reply_message  FROM messages     WHERE (content = ?)



#  æ•°æ®åº“å­—æ®µ å’Œ javaBeanå±æ€§å

##  ç»‘å®šé—®é¢˜

ä¸»è¦æ˜¯å¸¦å¤§å†™å­—æ¯çš„é—®é¢˜ï¼Œä¹‹å‰éƒ½æ²¡é‡è§

`@TableField` æ³¨é‡Šåœ¨å¯¹åº”çš„å±æ€§ä¸Šé¢ï¼Œå°±è¡¨ç¤ºè¯¥å±æ€§å’Œè¡¨ä¸­æŸå­—æ®µç»‘å®šï¼Œä¾‹å¦‚

```JAVA
@TableField("messageId")
public String messageId;
```

 è¡¨ç¤º åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ª` messageId` å­—æ®µï¼Œå¿…é¡»åŠ ä¸Šè¿™ä¸ªæ³¨é‡Š æ‰å¯ä»¥æµ‹è¯•é€šè¿‡

##  éƒ¨åˆ†å±æ€§ è¡¨ä¸­æ²¡æœ‰

æœ‰æ—¶å€™javaBean çš„æŸäº›å±æ€§ æ˜¯è¡¨ä¸­æ²¡æœ‰çš„ï¼Œè¿™æ—¶å€™éœ€è¦åŠ ä¸€ä¸ª

`@Transient` è¡¨ç¤ºè¯¥å±æ€§ å¯¹åº”çš„æ•°æ®è¡¨ä¸­æ²¡æœ‰

ç±»ä¼¼çš„ä¹Ÿæœ‰`@TableField(exist = false)`

## mysql å†…ç½®å…³é”®è¯

`date`ã€`timestamp`ä¹‹å,è¿˜æ˜¯æŠ¥é”™ 

> Error querying database.  Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'system,saved,distributed,seen,deleted,failure,disable_actions,disable_reactions,' at line 1

æ³¨æ„çœ‹ï¼š**near system**

å…¶å®å°±æ˜¯æ­¤å‰çš„éƒ½æ²¡é—®é¢˜ï¼Œé‚£å°±ç»§ç»­å¾€åæ‰¾ï¼Œé‚£å…¶å®å°±æ˜¯ç»§ç»­å¾€åèµ°ï¼Œå°±å¯ä»¥å‘ç°`sysytem`å¾ˆå€¼å¾—æ€€ç–‘ï¼Œä½†æ˜¯mysqlä¸é«˜äº®ï¼Œä¸€å¼€å§‹å°±æ²¡æ€€ç–‘ã€‚ç»“æœæ”¹äº†`system`ä¹‹åï¼Œ`ssystem` å°±å¥½äº†ï¼ï¼ï¼

##  å­¦ä¼šçœ‹sqlæŠ¥é”™

> SQL: SELECT  _id,index_id,content,username,room_id,sender_id,avatar,date,timestamp,system,saved,distributed,seen,deleted,failure,disable_actions,disable_reactions,reactions,files,reply_message  FROM messages     WHERE (content = ?)  

å…¶å®å°±æ˜¯å‘Šè¯‰ä½  ï¼Œ`mybatisPlus`å®é™…ä¸Šæ‰§è¡Œäº†å“ªä¸ªè¯­å¥

##  SELECT + å…¨éƒ¨å­—æ®µ

ä»¥å‰éƒ½æ˜¯ `select * from`

è¿™æ¬¡å¶ç„¶å‘ç°å…¶å®æ¥å…¨éƒ¨å­—æ®µä¹Ÿæ˜¯å¯ä»¥çš„

ä¸»è¦åŒºåˆ«æœ‰ï¼š

1. æŸ¥è¯¢æ•ˆç‡ä¸Šï¼šselect * åœ¨ç³»ç»Ÿè§£æçš„æ—¶å€™ä¼šå¤šä¸€æ­¥ä»ç³»ç»Ÿè¡¨è·å–å…·ä½“å­—æ®µçš„æ­¥éª¤ï¼Œå› æ­¤ä¼šæ¯”select å…¨éƒ¨å­—æ®µå¤šèŠ±æ—¶é—´ï¼Œæ•ˆç‡ç¨ä½ã€‚
2. æŸ¥è¯¢ç»“æœä¸Šï¼šåœ¨è¡¨ç»“æ„ä¸ä¿®æ”¹çš„æƒ…å†µä¸‹ç»“æœç›¸åŒï¼Œä½†æ˜¯åè€…çš„é¡ºåºå¯ä»¥è°ƒæ•´ï¼Œå‰è€…åˆ™å›ºå®šï¼›è€Œå¦‚æœä¿®æ”¹äº†è¡¨ç»“æ„ï¼Œå‰è€…èƒ½å¤Ÿè·å¾—æ–°è¡¨ç»“æ„çš„æ‰€æœ‰å­—æ®µï¼Œåè€…åˆ™ä¼šåœ¨ä¿®æ”¹å­—æ®µåæˆ–åˆ é™¤å­—æ®µæ—¶æŠ¥é”™ï¼Œä¼šåœ¨å¢åŠ å­—æ®µæ—¶ä¸ä¼šè¾“å‡ºæ–°å­—æ®µã€‚
3. åº”ç”¨åœºæ™¯ä¸Šï¼šselect * æ•ˆç‡ç¨ä½ä½†æ˜¯èƒ½åº”å¯¹é¢‘ç¹è°ƒæ•´çš„è¡¨ç»“æ„ï¼Œé€‚åº”åŠ›å¼ºï¼Œå¯åº”ç”¨äºå¼€å‘ç¯å¢ƒï¼Œä»…æå°‘æ•°ç‰¹æ®Šä¸šåŠ¡åœºæ™¯ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨åœºæ™¯ï¼›åè€…æ•ˆç‡ç¨é«˜è¯­æ„æ˜ç¡®ï¼Œæ›´èƒ½æ¸…æ™°çš„è¡¨è¾¾ä¸šåŠ¡çš„éœ€æ±‚ï¼Œå¼ºçƒˆå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

##  #{} ${}çš„åŒºåˆ«

https://blog.csdn.net/weixin_41231928/article/details/105120292

> **#{}** **æ˜¯** **å ä½ç¬¦** **ï¼šåŠ¨æ€è§£æ -> é¢„ç¼–è¯‘ -> æ‰§è¡Œ**
>
> **${}** **æ˜¯** **æ‹¼æ¥ç¬¦** **ï¼šåŠ¨æ€è§£æ -> ç¼–è¯‘ -> æ‰§è¡Œ**

sqlçš„é¢„ç¼–è¯‘ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œåœ¨æ‰§è¡Œå‰å°±ç¼–è¯‘å¥½ï¼Œç­‰æ‰§è¡Œæ—¶ç›´æ¥å–ç¼–è¯‘ç»“æœå»æ‰§è¡Œã€‚çœå»ç¼–è¯‘æ—¶é—´ã€‚sqlé¢„ç¼–è¯‘åä¼šåœ¨å‚æ•°ä½ç½®ç”¨å ä½ç¬¦è¡¨ç¤ºã€‚ é¢„ç¼–è¯‘å¯ä»¥ç±»æ¯”javaç±»çš„ç¼–è¯‘ï¼Œjavaç±»è¢«ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œè½½å…¥è™šæ‹Ÿæœºï¼Œè½½å…¥è™šæ‹Ÿæœºçš„å­—èŠ‚ç æ–‡ä»¶å¯ä»¥å…ˆè¢«ç¼–è¯‘æˆæœºå™¨å—ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡ŒæŸè¡Œä»£ç çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥æ‰§è¡Œç¼–è¯‘åçš„æœºå™¨ç ï¼Œè€Œä¸ç”¨ä»å­—èŠ‚ç å¼€å§‹ç¼–è¯‘å†æ‰§è¡Œï¼Œé‚£ä¹ˆæ‰§è¡Œæ•ˆç‡å°±é«˜äº†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºå•¥çƒ­æœºçŠ¶æ€æ¯”å†·æœºçŠ¶æ€å¯ä»¥æŠ—æ›´å¤šè´Ÿè½½çš„åŸå› ã€‚

é¢„ç¼–è¯‘å¯ä»¥å°†å¤šä¸ªæ“ä½œæ­¥éª¤åˆå¹¶æˆä¸€ä¸ªæ­¥éª¤ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¶Šå¤æ‚çš„sqlï¼Œç¼–è¯‘ç¨‹åº¦ä¹Ÿä¼šå¤æ‚ï¼Œéš¾åº¦å¤§ï¼Œè€—æ—¶ï¼Œè´¹æ€§èƒ½ï¼Œè€Œé¢„ç¼–è¯‘å¯ä»¥åˆå¹¶è¿™äº›æ“ä½œï¼Œé¢„ç¼–è¯‘ä¹‹åDBMSå¯ä»¥çœå»ç¼–è¯‘ç›´æ¥è¿è¡Œsqlã€‚
é¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤åˆ©ç”¨ã€‚
æŠŠä¸€ä¸ª sql é¢„ç¼–è¯‘åäº§ç”Ÿçš„ PreparedStatement å¯¹è±¡ç¼“å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å¯¹äºåŒä¸€ä¸ªsqlï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç¼“å­˜çš„ PreparedState å¯¹è±¡ã€‚

> 1. **#{} å¯¹åº”çš„å˜é‡ä¼šè‡ªåŠ¨åŠ ä¸Šå•å¼•å·** 
> 2. **${} å¯¹åº”çš„å˜é‡ä¸ä¼šåŠ ä¸Šå•å¼•å·** 

> 1. **#{} èƒ½é˜²æ­¢sql æ³¨å…¥**
> 2. **${} ä¸èƒ½é˜²æ­¢sql æ³¨å…¥**

#  æµ‹è¯•

å»ºç«‹å¥½äº†è¡¨ä¹‹åå¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œä¸€å †bugçˆ†å‡ºæ¥ä¹‹åç»ˆäºé€šäº†ã€‚

> [Messages{_id=1643, indexId=323, content='è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯æµ‹è¯•', username='xupt', senderId='333', avatar=123, date=Fri May 20 00:00:00 GMT+08:00 2022, timestamp=Fri May 20 12:06:23 GMT+08:00 2022, system=false, saved=true, distributed=true, seen=true, deleted=true, failure=true, disableActions=true, disableReactions=true, reactions=123, files=123, replyMessage=123}]

æ‹¿å‡ºæ¥äº†ä¸€ä¸ª`Message`ç±»å‹çš„æ•°æ®





#  ç™»é™†æ³¨å†Œæ¥å£

2022.05.19 ç»ˆäºå¼€å§‹äº†

## åå°æ¥å£è·å–å‚æ•°

ä¸€å¼€å§‹å°±æƒ³ç€ç›´æ¥æ¥å—`json`å¯¹è±¡ï¼Œä¸Šæ¥å°±ç”¨

```java
@PostMapping("/testGet")
    public User getUser(@RequesBody User user){
        System.out.println(user);
        return user;
    }
```

`@RequestBody` å°±æ˜¯æƒ³æŠŠæ‹¿è¿‡æ¥çš„å¯¹è±¡ï¼Œå°è£…æˆ`User`ç±»

ä½†æ˜¯å…¶å®ä¸ç”¨é‚£ä¹ˆå¤æ‚ï¼Œå¥¹é‚£è¾¹å°±æ˜¯å•çº¯ç»™äº†ä¸ªå‚æ•°è€Œå·²ã€‚æ‰€ä»¥å°±æ˜¯æ¥å—æ‰€ç»™çš„å‚æ•°å³å¯ã€‚è‡ªå·±è‡ªè¡Œæ„é€ ä¸€ä¸ª`bean` 

```java
@PostMapping("/testGet")
    public String getUser(@RequestParam("Phone") String Phone){
        System.out.println(Phone);
        return Phone;
}
```

å½“ç„¶é™¤äº†`@RequestParam`ä¹‹å¤–ï¼Œè¿˜æœ‰äº›å…¶ä»–çš„æ–¹å¼æ¯”å¦‚ 

```java
    @GetMapping("/hello/{name}")
    public String hello(@PathVariable("name") String name){}
```





# å…³äºè¿”å›jsonæ ¼å¼çš„ä¸€ç³»åˆ—é—®é¢˜

##  è¿”å›æ ¼å¼

é‚£è¾¹è¦æ±‚è¿”å›

```json
{
    code:    ;
    user:
    {
       username:    ;
       password:    ;
    
     }
}
}
```



è¿™ç§åµŒå¥—çš„`Json` ï¼Œå…¶å®è¿™éå¸¸ç¬¦åˆ`java` é¢å‘å¯¹è±¡çš„æ€æƒ³

æ¯”å¦‚å›¾é‡Œçš„ï¼Œç›´æ¥æä¸€ä¸ªæ–°çš„ç±»ï¼Œå°è£…`code` å’Œ `User`  å±æ€§è¿›å»å³å¯

ç„¶åè¿™é‡Œå°±ç‰µæ‰¯åˆ°è½¬æ¢äº†

## Gsonã€Jacksonã€FastJson

è¿™å‡ ä¸ªéƒ½æ˜¯æ–¹ä¾¿çš„è½¬æ¢å·¥å…·åŒ…ï¼Œç›´æ¥ ç±»å’Œ`json` äº’ç›¸è½¬æ¢



## ç›´æ¥ç”¨@ResponseBodyè¿”å›

æˆ–è€…ä¸éœ€è¦ç”¨è½¬æ¢åŒ…ï¼Œç›´æ¥åˆ©ç”¨æ³¨é‡Šçš„

```java
public LoginStaus login(User user) {
          QueryWrapper<User> queryWrapper = new QueryWrapper<>();
          queryWrapper.eq("Phone",user.Phone);
          queryWrapper.eq("Password",user.Password);
          //è‡ªå·±å®šä¹‰äº†ä¸€ä¸ªæ„é€ å™¨

          User validUser = usermapper.selectOne(queryWrapper);
          System.out.println(validUser);
          LoginStaus loginStaus = new LoginStaus();
          if (validUser != null) {
               loginStaus.setCode(1);//ç™»é™†æˆåŠŸï¼Œæœ‰æ­¤äºº
               loginStaus.setUserTry2Login(validUser);//åˆæ³•çš„ç”¨æˆ·å¡è¿›å»
          } else{
               //æŸ¥æ— æ­¤äºº
               loginStaus.code=0;//ç™»é™†å¤±è´¥ï¼ŒæŸ¥æ— æ­¤äºº
          }
          /**è¿™é‡Œåˆ©ç”¨gsonè½¬æ¢æˆjson æ ¼å¼ å¼€å§‹è¿”å›*/
          return loginStaus;
   }
```

è¿™é‡Œå…¶å®å°±æ˜¯è¿”å›äº†ä¸€ä¸ª`LoginStaus`çš„å¯¹è±¡ï¼Œç„¶ååœ¨`Controller`å±‚é‚£è¾¹åŠ ä¸Š`@ResponseBody` 

![image-20220524161053975](../JavaAllNotesResources/MyNotes/images/image-20220524161053975-16533798550791.png)

æŸ¥è¯¢æˆåŠŸã€è¿”å›æ¥çš„ç»“æœ

##  å…³äºæ³¨å…¥IOCç®¡ç†

ä¸Šæ‰‹é¡¹ç›®æ‰æ·±åˆ»ä½“ä¼šåˆ°`SpringBoot`çš„å„å¤„ç»†èŠ‚

è‡ªå·±æ‰“åŒ…çš„ä¸€ä¸ªç±»ï¼Œå…¶å®åªæ˜¯ç”¨æ¥æ–¹ä¾¿è½¬æ¢æˆ`json`	ï¼Œä½†æ˜¯å‘ç° 

å¦‚æœè¦`@Autowired` é‚£å°±æ˜¯é’ˆå¯¹ æˆå‘˜å˜é‡ã€æŸä¸ªå®ä¾‹çš„

`@Component`æ‰æ˜¯å¯¹äºç±»çš„





#  çŸ­ä¿¡

2022/05/25 ä¸‹åˆ

ç»è¿‡ä¸€æ³¢å¤§è´¹å‘¨ç« çš„ï¼Œæ€»ç®—æ˜¯æˆåŠŸåœ¨é˜¿é‡Œäº‘çš„ äº‘å•†åŸ ä¹°åˆ°äº†ä¸éœ€è¦å·¥å•†æ‰§ç…§çš„çŸ­ä¿¡å‘é€æœåŠ¡ã€‚



#  ç™»é™†+æ³¨å†Œ æ‹¦æˆªå™¨éªŒè¯

æ­å¥½äº†æ¡†æ¶ä¹‹åï¼Œå°±å¾ˆå¿«çš„æŠŠç™»é™†æ³¨å†Œä¸€ç³»åˆ—éƒ½å†™å¥½äº†

2022/5/25 æ™š å¼€å§‹è€ƒè™‘è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨çš„é—®é¢˜

ä¸€ä¸ªæ˜¯å‰ç«¯é‚£è¾¹ï¼Œæ³¨å†Œå…ˆå¡«å†™äº†æ­£ç¡®éªŒè¯ç åã€è®¾ç½®å¯†ç ï¼Œé‚£å°±å¾—çŸ­æš‚çš„å­˜å‚¨ä¸€ä¸‹è¿™ä¸ªæ‰‹æœºå·

ç›®å‰è€ƒè™‘ `Redis` 10åˆ†é’Ÿå­˜ä½

ç™»å½•è‚¯å®šæ˜¯è¦æ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨çš„

##  Token\Cookie\Session

å½“ä¸€æ¬¡ç™»å½•åï¼Œä¸‹æ¬¡ç™»é™†æ— éœ€å†æ¬¡è¾“å…¥è´¦å·å¯†ç ï¼Œè¯¥å¦‚ä½•åšåˆ°ä¹Ÿå¯ä»¥ç›´æ¥ç™»å½•ï¼Ÿ

> æ¯”å¦‚Bç«™ï¼Œæ‰“å¼€å°±å¯ä»¥ç›´æ¥ç”¨è€Œä¸ç”¨ç™»å½•

è¿™é‡Œå°±å¯ä»¥ç”¨`Token`ã€‚

> Tokençš„å¼•å…¥ï¼šTokenæ˜¯åœ¨å®¢æˆ·ç«¯é¢‘ç¹å‘æœåŠ¡ç«¯è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡ç«¯é¢‘ç¹çš„å»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç å¹¶è¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®ä¸å¦ï¼Œå¹¶ä½œå‡ºç›¸åº”æç¤ºï¼Œåœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒTokenä¾¿åº”è¿è€Œç”Ÿã€‚

> Tokençš„å®šä¹‰ï¼šTokenæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä»¥ä½œå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªä»¤ç‰Œï¼Œå½“ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªTokenä¾¿å°†æ­¤Tokenè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥åå®¢æˆ·ç«¯åªéœ€å¸¦ä¸Šè¿™ä¸ªTokenå‰æ¥è¯·æ±‚æ•°æ®å³å¯ï¼Œæ— éœ€å†æ¬¡å¸¦ä¸Šç”¨æˆ·åå’Œå¯†ç ã€‚

> ä½¿ç”¨Tokençš„ç›®çš„ï¼šTokençš„ç›®çš„æ˜¯ä¸ºäº†å‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå‡å°‘é¢‘ç¹çš„æŸ¥è¯¢æ•°æ®åº“ï¼Œä½¿æœåŠ¡å™¨æ›´åŠ å¥å£®ã€‚

[ä»€ä¹ˆæ˜¯token](https://www.jianshu.com/p/24825a2683e6)

[Token+Redisç™»å½•è®¤è¯](https://www.bilibili.com/video/BV1k34y1b7SC?spm_id_from=333.337.search-card.all.click)

[æœæœˆä½™æ™–](https://space.bilibili.com/27385378)

 [æ˜¯é‡‘å±±è€å¸ˆ](https://space.bilibili.com/548657327)

##  å­¦ä¹ Redisæ•´åˆSpringBoot

å› ä¸ºè¦ç”¨åˆ°`token` æ“ä½œ`redis ` æ•°æ®åº“ï¼Œæ‰€ä»¥å¤ä¹ ç”¨`RedisTemplate`æ“ä½œ

2022/05/26 æ™š å¤ä¹ redis

`RedisTemplate` å…¶å®å°±æ˜¯å¼•å…¥ä¸€ä¸ªmavenåŒ… ç„¶åç”¨`redisTemplate` å¯¹è±¡æ“ä½œå³å¯

è®°å¾—æ‰“å¼€`redis-server`æœåŠ¡å™¨ç«¯ï¼

##  Redis+Token å’Œ JWT

æˆåŠŸä½¿ç”¨äº†`Token` + `Redis` çš„æŠ€æœ¯è¿›è¡Œå­˜å‚¨ã€‚



#  å…³äºMySQLçš„ä¸€ç‚¹å°é—®é¢˜

é¦–å…ˆå¤ä¹ äº†å…³äº`MySQL`	çš„è¯­å¥ä¸­ï¼Œå¦‚ä½•ä¼ é€’å‚æ•°è¿›å»

å°±æ˜¯è¦ç”¨åˆ°å ä½ç¬¦

```mysql
insert into usersinfo (Username,Password) values (#{phone},#{password});
```



å…¶æ¬¡å°±æ˜¯é‡åˆ°äº†é—®é¢˜ï¼Œå› ä¸ºå»ºè¡¨çš„æ—¶å€™æŠŠUsernameè®¾ç½®äº†`NOT NULL`ä¸”æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼ã€‚

åˆä¸å‡†ç©ºç€ã€åˆä¸å‡†é»˜è®¤å€¼ï¼Œå½“ç„¶æŠ¥é”™å•¦ã€‚

å…¶å®è¿™å°±æ˜¯å»ºè¡¨çš„æ—¶å€™æ²¡æœ‰å’Œå‰ç«¯æ²Ÿé€šå¥½ï¼Œä»¥ä¸ºç”¨æˆ·å`Username` æ‰æ˜¯æœ€ä¸»è¦ã€å”¯ä¸€çš„ï¼Œå…¶å®åº”è¯¥æ˜¯æ‰‹æœºå·

å°±åº”è¯¥å…ˆæŠŠ	`Username` çš„ä¸»é”®çº¦æŸå»é™¤ï¼Œå¦åˆ™æ— æ³•ä¿®æ”¹ä¸ºå…è®¸`NULL`ï¼Œç„¶åæ”¹æˆ`phone` ä¸ºä¸»é”®

## è§£å†³åŠæ³•

å°±æ˜¯ä¿®æ”¹`Username`å­—æ®µçš„æƒé™ä¸º å¯ä»¥ä¸ºç©ºã€‚

```mysql
ALTER TABLE usersinfo DROP PRIMARY KEY;//åˆ é™¤ä¹‹å‰çš„é”™è¯¯ä¸»é”®Username
ALTER TABLE usersinfo MODIFY Username VARCHAR(32) NULL;//å–æ¶ˆUsernameçš„NOT NULL
ALTER TABLE usersinfo ADD PRIMARY KEY (Phone);//æŠŠPhoneæ”¹æˆä¸»é”®
```



-----------------------------------------

#  MileStoneï¼ç™»é™†æ³¨å†Œå®Œç¾å®ç°

2022/5/30 23:00 å®Œç¾å®ç°æ³¨å†Œ+ç™»å½•



# èŠå¤©å®¤å»ºè¡¨

(å¦‚æœæœ‰çš„å­—æ®µå’Œmysqlå†…ç½®çš„é‡åäº†ï¼Œé‚£å°±å¯ä»¥ç”¨ `  ç¬¦å·å¼•ç”¨èµ·æ¥é˜²æ­¢è¢«è¯†åˆ«ä¸ºå†…ç½®çš„é«˜äº® )

ä¹‹å‰ä¸€ç›´ä»¥ä¸ºçš„`Java Bean` å±æ€§å¿…é¡»å¯¹åº”ç›¸åº”çš„æ•°æ®åº“å­—æ®µï¼Œåé¢å‘ç°ä¹Ÿå¯ä»¥ä¸å®Œå…¨ä¸€ä¸€å¯¹åº”ï¼Œå…¶å®ä¸å¿…ï¼Œæ²¡æœ‰çš„å­—æ®µè‡ªå·±æš‚æ—¶å…ˆ`null`



```java
@Test
void testLackArgs() {
     List<Room> roomsLackTest = roomMapper.FindAllRooms();
     Iterator<Room> it = roomsLackTest.iterator();
      while(it.hasNext()){
         System.out.println(it.next().toString());
      }
}
```



![image-20220531172154298](../JavaAllNotesResources/MyNotes/images/image-20220531172154298-16539889166191.png)



![image-20220531172238372](../JavaAllNotesResources/MyNotes/images/image-20220531172238372-16539889593805.png)

æ¯”å¦‚

```java
 class User{
     int age;
     Sting name;
 }
 class Message{
     String content;
     Timestamp time;
     User sender;
 }
```

 å¾ˆæ˜æ˜¾åœ¨`MYSQL` æ•°æ®åº“é‚£è¾¹ä¸å¯èƒ½æä¸€ä¸ª`User` å­—æ®µæ¥å­˜`Sender`ï¼Œæ‰€ä»¥æŸ¥çš„æ—¶å€™ å¯ä»¥ä¸ä»æ•°æ®åº“ä¸­æŸ¥`Sender` ï¼Œå…ˆæŠŠåŸºç¡€æ•°æ®æŸ¥å‡ºæ¥ã€å†å»`User`è¡¨æŸ¥é‚£ä¸ªæ­£ç¡®çš„`Sender` æœ€åå¡«å……åˆ°	`Message.sender` å±æ€§ï¼Œä»¥æ„é€ ä¸€ä¸ªå®Œæ•´çš„`Message` ã€å˜æˆ`json` è¿”å›å»

 

##  å»ºè¡¨+å»ºç«‹å¯¹åº”Beanç±»

è‡ªä»æƒ³æ¸…æ¥š `Java Bean` çš„æ•°æ®ï¼Œå’Œæ•°æ®åº“å­—æ®µä¸ä¸€å®šå®Œå…¨å¯¹åº”åï¼Œå°±æ€è·¯å¼€é˜”äº†ã€‚

é‡åˆ°åµŒå¥—`json`å³ä¸æ˜¯`mysql`æ”¯æŒçš„åŸºæœ¬ç±»å‹ å°±å•ç‹¬æ‹¿å‡ºæ¥åšä¸€ä¸ªç±»ï¼Œåˆ°æ—¶å€™å¡«å……ã€‚

![image-20220531181225342](../JavaAllNotesResources/MyNotes/images/image-20220531181225342-16539919463177.png)

![image-20220531181245206](../JavaAllNotesResources/MyNotes/images/image-20220531181245206-16539919660989.png)

å…·ä½“çš„å±æ€§å°±æŒ‰ç…§å‰ç«¯ç»™è¿‡æ¥çš„`json` å†…å®¹ä¸€ä¸ªä¸ªåšå°±å¥½



# WebSocket

ä¹‹å‰çš„`Java SpringBoot` ã€`JavaWeb` å…¶å®éƒ½æ²¡æ¥è§¦è¿‡`WebSocket`è¿™ä¸€æ¬¡è¾¹å­¦è¾¹ç”¨ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡é˜…è¯»è‹±æ–‡æ–‡æ¡£ï¼Œæ„Ÿè§‰å¾ˆé€å½»ï¼è®°å½•ä¸€ä¸‹ï¼2022/5/31 21:00

> https://www.byteslounge.com/tutorials/java-ee-html5-websocket-example
>
> ä¸€ä¸ªç®€å•çš„WebSocket å°ä¾‹å­è®²è§£ï¼Œå¿«é€Ÿä¸Šæ‰‹ 
>
> https://www.oschina.net/translate/java-ee-html5-websocket-example
>
> å¯¹åº”çš„ä¸­æ–‡ç¿»è¯‘



2022/5/31 22ï¼š10 `@OnOpen`åŠå¤©æ‰¾ä¸åˆ°  è®°å¾—é¦–å­—æ¯å¤§å†™

##  SpringBootæ¼”ç¤º ï¼ˆå¤–ç½‘é«˜è´¨é‡è´´ï¼‰

[Building a chat application with Spring Boot and WebSocket](https://www.callicoder.com/spring-boot-websocket-chat-example/)

å¤–ç½‘é«˜è´¨é‡è´´ï¼Œä¸å¾—ä¸è¯´ å›½å†…`SpringBoot+WebSocket`çš„èŠå¤©å®¤é¡¹ç›®çœŸçš„èµ„æºåŒ®ä¹ï¼Œå…¨éƒ½æ˜¯`Node.js` åšåå°çš„ã€‚

[æ‰‹æŠŠæ‰‹æ­å»ºWebSocketå¤šäººåœ¨çº¿èŠå¤©å®¤ï¼ˆSpringBoot+WebSocketï¼‰](https://blog.51cto.com/rude3knife/2911879)

è¿™ä¸ªæ˜¯å›½å†…çš„ç¿»è¯‘å¸–å­ï¼Œå†…éƒ¨è¿˜æœ‰è¿›é˜¶åˆ†å¸ƒå¼ç‰ˆæœ¬



##  @OnOpen

```java
@OnOpen
public void onOpen(Session session){}
```

è¿™é‡Œçš„	`Session`  å…¶å®å°±æ˜¯ ä¸€ä¸ªæµè§ˆå™¨ç•Œé¢çš„ä¼šè¯

æ¯”å¦‚è¯´æˆ‘ç”¨`Firefox` ç™»å½•ä¸Šçº¿äº†ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª`Session`äº†ï¼Œè¿™ä¸ª`Session`  åœ¨æœåŠ¡å™¨è¿™è¾¹å…¶å®å°±æ˜¯ä¸€ä¸ªç”¨æˆ·ï¼Œåªä¸è¿‡éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ª	`ConcurrentHashMap<String,Session>` æ¥æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·çš„ç”¨æˆ·å

```java
@OnOpen
    public void onOpen(Session session, EndpointConfig endConfig){
        //ä¸€æ—¦å»ºç«‹é“¾æ¥ å°±å¯ä»¥å…ˆèµ‹å€¼äº†
        this.Isession=session;
        //ä»GetHttpSessionConfiguratoré…ç½®ç±»çš„modifyæ–¹æ³• è·å–HttpSessionå¯¹è±¡
        HttpSession httpSession =(HttpSession) endConfig.getUserProperties().get(HttpSession.class.getName());
        this.IhttpSession = httpSession;

        //æ¥ä¸‹æ¥å°±æ˜¯ä»httpSessionä¸­æ‹¿åˆ°ç”¨æˆ·å,ï¼Œå› ä¸ºä¹‹å‰ç™»å½•çš„æ—¶å€™ï¼Œç™»å½•ç”¨æˆ·æ”¾è¿›æ¥äº†
        String username = (String) IhttpSession.getAttribute("username");

        //æ”¾å…¥åœ¨çº¿åˆ—è¡¨
        onlineUsers.put("username",this);
    }
```

å…¶å®è¿™é‡Œä¸ç”¨å¦‚æ­¤éº»çƒ¦ï¼Œç®€å• çš„æ–¹æ³•å°±æ˜¯ç›´æ¥åœ¨å‚æ•°è¡¨é‡Œå†™ä¸Šä¸€ä¸ª `(@Param String username)`
`@ServerEndpoint(value="chatPrivate/{username}â€œ)` å°±å¯ä»¥å¾ˆè½»æ¾çš„æŠŠå½“å‰ç™»å½•ç”¨æˆ·æ‹¿å‡ºæ¥äº†
è€Œä¸ç”¨é‚£ä¹ˆéº»çƒ¦çš„æ”¾åœ¨Session å†å–

 

## @OnMesage



##  å…³äºJakcson\JSONObject

è§†é¢‘æ•™ç¨‹é‡Œå‡ºç°çš„åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨äº†`Jackson`åŒ…æ“ä½œ`Json` `Java Bean` ä¹‹é—´çš„ç›¸äº’è½¬åŒ–

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¼¼ä¹`SendMessage` é‡Œé¢æ˜¯æŠŠ`String` å‘é€å‡ºå»ã€å‰ç«¯é‚£è¾¹å¯ä»¥è‡ªåŠ¨è¯†åˆ«`String`ç±»å‹çš„å¹¶ä¸”è§£è¯»ä¸º`Json` 



```java
//å…¶ä¸­messageæ˜¯ä¼ è¾“è¿‡æ¥çš„Stringç±»å‹çš„æ¶ˆæ¯ï¼Œä½†æ˜¯å¯ä»¥è¢«è¯†åˆ«ã€æ‹†è§£ä¸ºJson
JSONObject inMesObj = JSONUtil.parseObj(message);
        String toUsername = inMesObj.getStr("to"); // toè¡¨ç¤ºå‘é€ç»™å“ªä¸ªç”¨æˆ·ï¼Œæ¯”å¦‚ admin
        String text = inMesObj.getStr("text"); // å‘é€çš„æ¶ˆæ¯æ–‡æœ¬  hello

```

ç”±ä»£ç å¯çœ‹å‡ºæ¥ï¼Œæ ¹æ®è½¬æ¢å¥½çš„`mesObj` å¯ä»¥æ‹¿éœ€è¦çš„å†…å®¹ï¼Œå¹¶ä¸”å†å¡«å……åˆ°è‡ªå·±çš„`Message Bean` é‡Œé¢å­˜å‚¨éƒ½å¯ä»¥

`Session toSession = sessionMap.get(toUsername);`

  æ ¹æ® toç”¨æˆ·å æ¥è·å–æ¥æ”¶è€…çš„ `Session`ï¼Œå†é€šè¿‡`session`å‘é€æ¶ˆæ¯å‡ºå»

```java
JSONObject outMesObj  = new JSONObject();
            outMesObj.set("from", username);  // from æ˜¯ zhang
            outMesObj.set("text", text);  // text åŒä¸Šé¢çš„text
            this.sendMessage(jsonObject.toString(), toSession);
```

å¯¹ç§°çš„æ“ä½œï¼ŒçŸ¥é“è¦å‘ç»™è°ä¹‹åï¼Œå°è£…å¥½ã€å†å‘å‡ºå»



```java
/**
 * æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯
 */
private void sendMessage(String message, Session toSession) {
       try {
         log.info("æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯[{}]å‘é€æ¶ˆæ¯{}", toSession.getId(), message);
         toSession.getBasicRemote().sendText(message);
      }catch (Exception e) {
         log.error("æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯å¤±è´¥", e);
      }
}

```

æƒ³å‘ç»™å“ªä¸ª`Session`ï¼Œå°±è°ƒç”¨è¯¥`Session`çš„`getBasicRemote().sendText(message)`æ–¹æ³• 



#  ç¾¤èŠæ€è·¯â­

##  1.0 åŸºäºæ™®é€šéå†æ€è·¯

ä¸€ç›´å—å›°äºç¾¤èŠè¯¥æ€ä¹ˆåšï¼Œæ¯•ç«Ÿç§èŠè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œæ¯•ç«Ÿåªéœ€è¦å‘ç»™å›ºå®šçš„äººã€‚

åœ¨ç½‘ä¸Šæœäº†ä¸€åœˆ*WebSocketç¾¤èŠå¦‚ä½•å®ç°* å‡ ä¹éƒ½æ˜¯æ¸…ä¸€è‰²çš„ä¸€æ¬¡æ€§æ‰€æœ‰äººéƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œç„¶è€Œæˆ‘ä»¬æƒ³è¦çš„è‚¯å®šä¸æ˜¯è¿™ä¸ªæ•ˆæœã€‚æ¢è¨€ä¹‹ï¼Œè¿™æ˜¯å…¨èŠã€‚ç¾¤èŠå¯ä»¥ç†è§£ä¸º éƒ¨åˆ†äººçš„å…¨èŠ æˆ–è€…æ˜¯ å¤šä¸ªäººçš„ç§èŠã€‚

æ ¹æ®åˆšæ‰çš„ç†è§£ï¼š`Session` å…¶å®å°±ä»£è¡¨ç€ä¸€ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆå…¶å®å°±æ˜¯éå†ä¸€ä¸ªé›†åˆã€ç»™è¿™ä¸ªé›†åˆé‡Œé¢çš„`Sessions`å‘æ¶ˆæ¯ã€‚

è¿™ä¸ªé›†åˆ`Set` å°±æ˜¯ä¹‹å‰çš„`Rooms` ,è¿™ä¸ªç¾¤æœ‰å“ªäº›äºº,å°±ç»™å“ªäº›ï¼ˆ`Sessions`ï¼‰å‘ä¸å°±è¡Œäº†å—ï¼Ÿï¼

Roomsä¹‹å‰å­˜å‚¨äº†`Phone`ï¼Œé‚£å°±å¾ˆå¥½åŠäº†

1. ä»`Room`æ•°æ®åº“å–å‡ºè¯¥ç¾¤èŠçš„æ‰€æœ‰`Phone` 
2. ç„¶åå»ºç«‹`ConcurrentHashMap<Phone,Session>` å³å¯
3. éå†è¯¥`HashMap`çš„`Values` ,æŠŠä¸€ä¸ªä¸ª`Session `æ‰¾å‡ºæ¥ã€å‘æ¶ˆæ¯ï¼



##  2.0 åŸºäºèŠå¤©å®¤æ€è·¯

2022.06.05 æ™š21:30 å‰ç«¯è®¾è®¡çš„æ€è·¯æ˜¯ï¼š

åŸºäºèŠå¤©å®¤	`Room`  çš„æ€è·¯ï¼ŒæŠŠç§èŠå½“æˆä¸¤ä¸ªäººçš„ç¾¤èŠã€‚å½“ä¸€ä¸ªæ¶ˆæ¯è¿‡æ¥çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“æ˜¯è°å‘çš„ã€åœ¨å“ªä¸ªèŠå¤©ç¾¤/æˆ¿é—´`Room` å‘çš„ï¼Œç„¶åå»æ‰¾ï¼Œè¿™ä¸ªç¾¤é‡Œæœ‰å“ªäº›äººï¼Œè¿™æ ·å†å»æ•°æ®åº“é‡Œé¢æŸ¥ã€‚

`message.getRoomID`  æ‹¿åˆ°èŠå¤©å®¤

`room` å»æ•°æ®åº“é‡Œé¢æŸ¥`List<Users>` 

æ ¹æ®éå†`List<Uers>` ï¼Œæ‹¿åˆ°ä¸€ä¸ªä¸ªç¾¤æˆå‘˜ï¼Œç„¶åå»`HashMap<String ,Session>` 

##  List<T> çš„èµ‹å€¼é—®é¢˜

æŸ¥å‡ºæ¥çš„æ˜¯ä¸€ä¸ª`List<File>` ä½†æ˜¯`msg`ä½œä¸º`javaBean`æœ¬èº«ä¹Ÿæœ‰ä¸€ä¸ªList<File> çš„å±æ€§ï¼Œèµ‹å€¼çš„è¯

ä¸€å¼€å§‹æ˜¯ `A=B` è¿™æ · ä½†æ˜¯ä¹Ÿä¸æ”¾å¿ƒï¼Œæ­£è§„åšæ³•æ˜¯

`ArrayList Bã€€ï¼ new ArrayList<> (A);`

`ArrayList Bã€€ï¼ A.clone();`

`ArrayList Bã€€ï¼ new ArrayList<String>(); B.addAll(A);`

`for(String s: A) B.add(s);`

##  æ·±æµ…æ‹·è´

æµ…æ‹·è´åªå¤åˆ¶æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼Œè€Œä¸å¤åˆ¶å¯¹è±¡æœ¬èº«ï¼Œæ–°æ—§å¯¹è±¡è¿˜æ˜¯å…±äº«åŒä¸€å—å†…å­˜ï¼Œ æ‰€ä»¥**å¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªåœ°å€ï¼Œå°±ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡**ã€‚ã€‚

æµ…æ‹·è´å¯¹åº”çš„å°±æ˜¯æ·±æ‹·è´ï¼Œæ·±æ‹·è´æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­å®Œæ•´çš„æ‹·è´ä¸€ä»½å‡ºæ¥,ä»å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çš„åŒºåŸŸå­˜æ”¾æ–°å¯¹è±¡,ä¸”**ä¿®æ”¹æ–°å¯¹è±¡ä¸ä¼šå½±å“åŸå¯¹è±¡**ã€‚

#  å¸¦å›¾ç‰‡/æ–‡ä»¶

å…¶å®è¿™ä¸ªå°±æ¶‰åŠåˆ°äº†`MultipartFile` ç±»çš„å¤„ç†ï¼Œæœ¬è´¨ä¹Ÿä¸éš¾ï¼ŒCSDNå¾ˆå¤šå¯ä»¥ç›´æ¥æœåˆ°ã€‚æœ¬è´¨ä¸Šå°±æ˜¯æ¥å£é‡Œï¼Œæ¥æ”¶ä¸€ä¸ª

```JAVA
@RequestMapping("jsonDataAndUploadFile")
@ResponseBody
public String jsonDataAndUploadFile(@RequestPart("uploadFile") MultiPartFile uploadFile, @RequestPart("jsonData") Person person) {
    StringBuilder sb = new StringBuilder();
    sb.append(uploadFile.getOriginalFilename()).append(";;;"));
    return person.toString() + ":::" + sb.toString();
}

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œå€Ÿç‰©å°äººã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/u012894692/article/details/115875674
```

è€Œå¯¹äº `@RequestPart`å’Œ`@RequstParam`

> è¯‘æ–‡ï¼š
> 1.@RequestPartè¿™ä¸ªæ³¨è§£ç”¨åœ¨multipart/form-dataè¡¨å•æäº¤è¯·æ±‚çš„æ–¹æ³•ä¸Šã€‚
> 2.æ”¯æŒçš„è¯·æ±‚æ–¹æ³•çš„æ–¹å¼MultipartFileï¼Œå±äºSpringçš„MultipartResolverç±»ã€‚è¿™ä¸ªè¯·æ±‚æ˜¯é€šè¿‡httpåè®®ä¼ è¾“çš„ã€‚
> 3.@RequestParamä¹ŸåŒæ ·æ”¯æŒmultipart/form-dataè¯·æ±‚ã€‚
> 4.ä»–ä»¬æœ€å¤§çš„ä¸åŒæ˜¯ï¼Œå½“è¯·æ±‚æ–¹æ³•çš„è¯·æ±‚å‚æ•°ç±»å‹ä¸å†æ˜¯Stringç±»å‹çš„æ—¶å€™ã€‚
> 5.@RequestParamé€‚ç”¨äºname-valueStringç±»å‹çš„è¯·æ±‚åŸŸï¼Œ@RequestParté€‚ç”¨äºå¤æ‚çš„è¯·æ±‚åŸŸï¼ˆåƒJSONï¼ŒXMLï¼‰ã€‚
> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œå‘å°å‡¯åŒå­¦å­¦ä¹ ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
> åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/wd2014610/article/details/79727061



##  ä¸Šä¼ ä¸ªäººå¤´åƒ

è¿™ä¸ªæ˜¯æœ€ç®€å•çš„ï¼Œå•ç‹¬ä¸€ä¸ªæ¥å£ï¼Œå°±ç®€å•çš„æ¥æ”¶å³å¯

##  ç¾¤å¤´åƒ

ç¾¤å¤´åƒå°±æ˜¯`form` ç±»å‹çš„æ¥æ”¶ï¼Œå¾ˆå¤šCSDNéƒ½å¯ä»¥ç”±

##  æ¶ˆæ¯å†…çš„å›¾ç‰‡

å‰ç«¯æ”¯æŒ`Blob` ï¼Œé‚£å°±éå¸¸å¥½äº†ï¼Œåå°çš„æ•°æ®åº“`mysql`ä¹Ÿæ”¯æŒ`Blob`ç±»å‹ï¼Œå¯ä»¥ç›´æ¥æ“ä½œä½¿ç”¨çš„

[å¦‚ä½•åœ¨ MySQL / MariaDB ä¸­å®ç°å›¾ç‰‡å­˜å‚¨ï¼ŒBLOB æ•°æ®ç±»å‹è¯¦è§£](https://kalacloud.com/blog/how-to-use-the-mysql-blob-data-type-to-store-images-with-php-or-kalacloud/)

ä¹‹å‰è®¾è®¡çš„è¡¨ä¸­ï¼Œå…¶å®è¿˜æ˜¯æ²¿ç”¨äº†è®°å½•åœ°å€çš„æ€è·¯ï¼Œå¯ä»¥è€ƒè™‘åŠ ä¸€ä¸ª`Blob`å­—æ®µï¼Œç›´æ¥å­˜å›¾ç‰‡



æŠ¥é”™ï¼šå…¶å®è¿™ä¸ª æ²¡å•¥å¤§é—®é¢˜ï¼Œå°±æ˜¯ä¼ è¿‡æ¥çš„`Json`ï¼Œæ²¡æœ‰å‡†å¤‡å¥½å¯¹åº”çš„`Bean`å®ä½“ç±»å­—æ®µè€Œå·²

> com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: 
>
> Unrecognized field "roomId" (class com.chatroom.chatroom.beanPo.Messages), not marked as ignorable
>
>  (19 known properties: "disableReactions", "distributed", "saved", "failure", "indexId", "date", "system", "senderId", "disableActions", "username", "files", "content", "_id", "seen", "replyMessage", "reactions", "timestamp", "avatar", "deleted"])at 
>
> [Source: (String)"
>
> {"roomId":2,
>
> "content":"å•æ–¹äº‹æ•…ç‘å…¸æ­Œæ‰‹ğŸ¤‘ğŸ˜š",
>
> "senderId":1234,
>
> "username":"PintTing",
>
> "avatar":" ",
>
> "date":"2022-06-07"ï¼Œ
>
> "timestamp":"21:10:44",
>
> "system":false,
>
> "saved":true,
>
> "distributed":true,
>
> "seen":true,
>
> "deleted":false,
>
> "failure":false,
>
> "disableActions":false,
>
> "disableReactions":false,
>
> "files":[
>
> â€‹     {"name":"Lunixè¿›ç¨‹ç®¡ç†",
>
> â€‹		"size":91233,"
>
> â€‹		type":"image/jpeg",
>
> â€‹		"audio":false,
>
> â€‹		"duration":0,
>
> â€‹		"url":"blob:http://localhost:8080/99582bc7-63c9-4e70-845d-8730a797eed5",
>
> â€‹		"preview":"blob:http://localhost:8080/99582bc7-63c9-4e70-845d-8730a797"
>
> â€‹	}
>
> }
>
> â€‹		[truncated 296 chars]; line: 1, column: 12]
>
>  (through reference chain: com.chatroom.chatroom.beanPo.Messages["roomId"])

**19 known properties** æ³¨æ„è¿™é‡Œï¼Œå…¶å®æ„æ€å°±æ˜¯è¯†åˆ«å‡º19ä¸ªå­—æ®µäº†



2022/06/08 æ™š21ï¼š00  éšä¾¿åˆ›å»ºäº†ä¸€ä¸ª`Blob`çš„è¡¨ï¼Œå¹¶ä¸”åˆ›å»ºäº†å¯¹åº”çš„`Bean`ã€`Mapper` é‡åˆ°å‡ æ¬¡æ³¢æŠ˜

æœ€ä¸»è¦çš„å°±æ˜¯ é”™ä»¥ä¸º`Java`å†…ç½®çš„`Blob`ç±»å‹~~å¯ä»¥~~ç”¨äºæ¥æ”¶æŸ¥è¯¢å‡ºæ¥çš„`Blob`ç±»å‹	

ç„¶è€ŒBlobæ˜¯å¯¹åº”**Byte[]** å­—èŠ‚æ•°ç»„çš„ï¼

å…¶æ¬¡å°±æ˜¯ä¸€äº›ç»†èŠ‚é—®é¢˜ï¼Œ**ä¸€æ¡æ•°æ®**å¯¹åº”çš„æ˜¯ä¸€ä¸ª`JavaBean` ä¸è¦æ··äº†

#  æ•°æ®åº“ 2.0

ç”¨æˆ·Userã€ç¾¤èŠæˆ¿é—´`Room`  ã€æ¶ˆæ¯`Message` 

ç”¨æˆ·ä¹‹é—´è°å’Œè°æ˜¯å¥½å‹ã€å“ªä¸ªæ¶ˆæ¯æ˜¯å“ªä¸ªç”¨æˆ·å‘çš„ã€è¿™ä¸ªæ¶ˆæ¯å±äºå“ªä¸ªæˆ¿é—´ã€è¿™ä¸ªæˆ¿é—´é‡Œæœ‰å“ªäº›ç”¨æˆ·

å¯¹äºæ•°æ®åº“çŸ¥è¯†çš„ä¸€æ¬¡é›†ä¸­åº”ç”¨

##  æ•´ä½“ç”¨æˆ·å…³ç³»è®¾è®¡å›¾

##  ç”¨æˆ·å’Œç¾¤èŠï¼ˆç»å…¸å¤šå¯¹å¤šï¼‰

ä¸€ä¸ªç”¨æˆ·æœ‰å¯ä»¥å­˜åœ¨äºå¤šä¸ªç¾¤èŠä¸­ï¼Œä¸€ä¸ªç¾¤èŠä¸­ä¹Ÿå­˜åœ¨å¤šä¸ªæˆå‘˜ã€‚

å…¸å‹çš„ å¤šå¯¹å¤š å…³ç³»ï¼Œä¹‹å‰å­¦ä¹ æ•°æ®åº“çš„æ—¶å€™ å­¦è‰ºä¸ç²¾ï¼Œæ²¡æœ‰

å°±æ˜¯`Users`è¡¨ å’Œ `Rooms` è¡¨ ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»

![image-20220607192429559](../JavaAllNotesResources/MyNotes/images/image-20220607192429559-16546010704651.png)

[å¤šè¡¨æ“ä½œâ€”å¤šå¯¹å¤šå…³ç³»æ•°æ®æ“ä½œ](https://www.bilibili.com/video/BV1gU4y157JN?spm_id_from=333.999.0.0)

```mysql
ALTER TABLE UserRoom ADD FOREIGN KEY(Phone) REFERENCES usersinfo (Phone);
ALTER TABLE UserRoom ADD FOREIGN KEY(roomId) REFERENCES room (roomId);
```

è®¾ç½®ä¸­é—´è¡¨çš„ä¸¤ä¸ªå­—æ®µ å„è‡ªå’Œç”¨æˆ·ä¿¡æ¯è¡¨ã€ç¾¤èŠæˆ¿é—´è¡¨ å»ºç«‹å¤–é”®

`usersinfo` çš„`Phone` å¯¹åº” `userroom`  çš„`Phone`  `room` çš„`roomId` å¯¹åº” `userroom`  çš„`roomId`

 ![image-20220607213107647](../JavaAllNotesResources/MyNotes/images/image-20220607213107647-16546086738921.png)

æ‰€ä»¥`userroom`è¡¨å°±æ˜¯è¿™æ ·çš„æ•ˆæœ ![image-20220607213154507](../JavaAllNotesResources/MyNotes/images/image-20220607213154507-16546087163913.png)

ps: å¤–é”®å°±çº¦æŸã€ä¿è¯æ•°æ®åˆæ³•ã€åˆç†æ€§çš„ã€‚

æ¶ˆæ¯è¡¨`Message`çš„`roomId`æ˜¯è·Ÿéšç¾¤èŠè¡¨`room` ï¼Œæ‰€ä»¥ä¸å­˜åœ¨çš„ç¾¤èŠIDï¼Œåœ¨æ¶ˆæ¯è¡¨éƒ½ä¸å…è®¸å­˜å…¥

æ¯”å¦‚roomè¡¨ä¸å­˜åœ¨5å·room,`Message`è¡¨é‡Œå°±æ— æ³•æœ‰ä¸€æ¡`roomId`ä¸º5çš„æ•°æ®ï¼Œå¦åˆ™å°±æŠ¥é”™

> Cannot add or update a child row: a foreign key constraint fails 	



> ##  ç”¨æˆ·ä¹‹é—´çš„å¥½å‹å…³ç³»
>
> å¯ä»¥ç›´æ¥ç”¨`Redis`å­˜ï¼Œå› ä¸ºå…¶å®å°±æ˜¯ä¸¤ä¸ªäººä¹‹é—´çš„å…³ç³»ï¼Œ`Redis`æœ¬èº«æä¾›`List`ï¼Œåˆ©ç”¨`RedisTemplate.opsForList()` å¯ä»¥ç›´æ¥å­˜å‚¨ã€åˆ é™¤
>
> ä¸€ä¸ª`List`çš„`key`å°±æ˜¯ç™»å½•ç”¨æˆ·çš„æ‰‹æœºå·ï¼Œç„¶åå†…å®¹å°±æ˜¯å¥½å‹ï¼Œä¸ç”¨`Set`æ˜¯å› ä¸ºå¥½å‹çš„åˆ·æ–°é¡ºåºä¹Ÿæœ‰è¦æ±‚ã€‚
>
> éœ€è¦æå–ä¸€ä¸ªäººçš„æ‰€æœ‰å¥½å‹ï¼Œå°±ç›´æ¥
>
> ```   java
> List<String> friends = redisTemplate.opsForList.range(userPhone,0,-1);
> ```
>
> è¿”å›æ‰€æœ‰å¥½å‹ï¼Œåˆ é™¤å¥½å‹ç­‰éƒ½æœ‰ã€‚
>
> PSï¼šå¦‚æœæ˜¯å¤‡æ³¨ï¼Œé‚£å°±å®Œå…¨ä¸åŒäº†ï¼ŒçœŸçš„éœ€è¦ç”¨åˆ°`mysql`äº†ï¼Œmybatis-Plusåˆ›å»ºè¡¨è¿˜æ˜¯æŒºå¤æ‚äº†ï¼Œå°±ä»¥åå†è¯´äº†
>



#  Java æ“ä½œ Blob 

```JAVA
@Test
void showBlob() throws IOException {
        List<BlobTest> blobTests = blobMapper.showBlobs();
        Iterator<BlobTest> it = blobTests.iterator();
        System.out.println(blobTests.size());
        BlobTest next = it.next();
        String picName = next.toString().substring(3, 6)+".jpg";
        File tempFile = new File("D:\\ä¸ªäººæ–‡ä»¶\\è½¯åç›¸å…³\\" + picName);
        OutputStream os = new FileOutputStream(tempFile);
        os.write(next.pictures);
}
```

`Blob` ç±»å‹åœ¨`Java`é‡Œé¢å…¶å®å°±ç”¨`Byte[]`å­—èŠ‚æ•°ç»„æ¥æ”¶å³å¯ï¼Œä¹‹å‰è‡ªä½œä¸»å¼ ç”¨äº†`Blob`å†…ç½®ç±»å‹ï¼Œåè€ŒæŠ¥é”™ã€‚

ç„¶åç”¨`File`æ–‡ä»¶ç±»æ“ä½œå³å¯



#  Form-data æŠ¥é”™

2022-06-10 13:15:03.237  INFO 17500 --- [nio-8080-exec-9] org.apache.tomcat.util.http.Parameters   : Character decoding failed. Parameter [------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name] with value ["userId"

1234
------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name="roomId"

2
------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name="messageId"

2022-6-1013:153306
------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name="name"

LunixÃ¨Â¿Â›Ã§Â¨Â‹Ã§Â®Â¡Ã§ÂÂ†
------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name="size"

91233
------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name="type"

image/jpeg
------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name="index"

0
------WebKitFormBoundaryr5zqGgof4qHSnMrc
Content-Disposition: form-data; name="img"; filename="LunixÃ¨Â¿Â›Ã§Â¨Â‹Ã§Â®Â¡Ã§ÂÂ†"
Content-Type: image/jpeg

Ã¿Ã˜Ã¿Ã  JFIF  Ãœ Ãœ  Ã¿Ã› C	
2!!22222222222222222222222222222222222222222222222222Ã¿Ã€ Â·Ã²" Ã¿Ã„           	
Ã¿Ã„ Âµ   } !1AQa"q2ÂÂ‘#BÂ±ÃRÃ‘Ã°$3brÂ‚	
%] **has been ignored. Note that the name and value quoted here may be corrupted due to the failed decoding. Use debug level logging to see the original, non-corrupted values.**
 **Note: further occurrences of Parameter errors will be logged at DEBUG level.**
2022-06-10 13:15:03.250 ERROR 17500 --- [nio-8080-exec-9] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is

 **java.lang.ClassCastException: org.apache.catalina.connector.RequestFacade cannot be cast to org.springframework.web.multipart.MultipartHttpServletRequest] with root cause**

**java.lang.ClassCastException: org.apache.catalina.connector.RequestFacade cannot be cast to org.springframework.web.multipart.MultipartHttpServletRequest**
	at com.chatroom.chatroom.controller.MessageController.getFile(MessageController.java:49) ~[classes/:na]
	



##  è§£å†³æ–¹æ³•ï¼šRequestFacade cannot be cast to MultipartHttpServletRequestå¼‚å¸¸

https://blog.csdn.net/sinat_32469267/article/details/99777575?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-99777575-blog-49576281.pc_relevant_paycolumn_v3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-99777575-blog-49576281.pc_relevant_paycolumn_v3&utm_relevant_index=3

å†…éƒ¨çš„è§£å†³æ–¹æ³•ä¸€å’Œä¸‰éƒ½è¯•äº†



##  è‡ªå·±æ‰¾åˆ°çš„



1. é€šè¿‡æ£€æŸ¥ä¸Šä¼ æ•°æ®çš„Content-Typeæ˜¯multipart/form-dataï¼›è·Ÿç½‘ä¸ŠæŸ¥çš„ä¸€è‡´ï¼›å¹¶æ— å¼‚æ ·ã€‚
2. åœ¨ç½‘ä¸Šæ‰¾åˆ°è¯´æ˜¯axiosçš„é…ç½®é—®é¢˜ï¼Œå¯¼è‡´ä¸Šä¼ çš„æ•°æ®è¢«åºåˆ—åŒ–å¯¼è‡´ä¸ºnullçš„ï¼›å¼•è‡´åå°æŠ¥é”™ä¸ºç©ºæŒ‡é’ˆé”™è¯¯ã€‚é€šè¿‡å¯¹axiosé…ç½®æ–‡ä»¶çš„æ£€æŸ¥ä¹Ÿå‘ç°axioså¯¹Formdataçš„æ•°æ®æœ‰è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶æ— å¯¹FormDataæ•°æ®è¿›è¡Œåºåˆ—åŒ–ã€‚
3. é‚£é—®é¢˜æ¥äº†ã€‚æ—¢ç„¶æ•°æ®æ²¡æœ‰è¢«åºåˆ—åŒ–ï¼Œä¹Ÿåˆ°è¾¾äº†åå°ï¼Œä½†åå°å´è·å–ä¸ºnullï¼ŒåŸå› åœ¨äºæˆ‘ä¸Šä¼ FormDataæ•°æ®çš„å®šä¹‰åå­—è·Ÿåå°è·å–çš„åå­—ä¸ä¸€è‡´æ‰€å¯¼è‡´çš„é—®é¢˜ã€‚ä¸»è¦ä¸€å¼€å§‹æ²¡è·Ÿåå°æ²Ÿé€šå¥½å¯¼è‡´çš„é”™è¯¯ã€‚
4. ![image-20220610154311293](../JavaAllNotesResources/MyNotes/images/image-20220610154311293-16548469922821.png)

å±…ç„¶æ˜¯`application/json`çš„headerï¼Ÿ

![image-20220610155248590](../JavaAllNotesResources/MyNotes/images/image-20220610155248590.png)



----------------------------

# æœŸæœ«è€ƒï¼ˆ6.28~7.9ï¼‰ 

åŠä¸ªæœˆå·¦å³çš„æ—¶é—´å‡ ä¹åœæ» æ—¶é—´æ‹¿å»å¤ä¹ äº†



#  å®Œå–„æ–‡ä»¶åŠŸèƒ½

2022\07\12

æœ‰äº†ä¼ åŸºäºBASE64ä¼  å›¾ç‰‡ çš„ç»éªŒï¼ŒéŸ³é¢‘ã€è§†é¢‘ä¹Ÿä¸åœ¨è¯ä¸‹äº†ï¼Œå›æ¥å°±å…ˆæŠŠè¿™ä¸ªåŠŸèƒ½ç»™åšäº†

#  å†…ç½‘ç©¿é€

2022\07\13

æš‘æœŸå›åˆ°å®¶ï¼Œé‚£å°±é¡ºä¾¿åšäº†ä¸ªå†…ç½‘ç©¿é€ã€‚å› ä¸ºå‰åç«¯å„è‡ªå›å®¶ï¼Œè‚¯å®šä¸èƒ½å†ç›´æ¥åœ¨ä¸€ä¸ªå±€åŸŸç½‘ä¸‹é¢äº†

é¡ºä¾¿å­¦ä¹ äº†**å†…ç½‘ç©¿é€**çš„çŸ¥è¯†

##  åŸºæœ¬æ¦‚å¿µ

> å†…ç½‘ç©¿é€ï¼Œä¹Ÿå³ NAT ç©¿é€ï¼Œè¿›è¡Œ NAT ç©¿é€æ˜¯ä¸ºäº†ä½¿å…·æœ‰æŸä¸€ä¸ªç‰¹å®šæº IP åœ°å€å’Œæºç«¯å£å·çš„æ•°æ®åŒ…ä¸è¢« NAT è®¾å¤‡å±è”½è€Œæ­£ç¡®è·¯ç”±åˆ°å†…ç½‘ä¸»æœºã€‚ä¸‹é¢å°±ç›¸äº’é€šä¿¡çš„ä¸»æœºåœ¨ç½‘ç»œä¸­ä¸ NAT è®¾å¤‡çš„ç›¸å¯¹ä½ç½®ä»‹ç»å†…ç½‘ç©¿é€æ–¹æ³•ã€‚ [1] 
>
> UDP å†…ç½‘ç©¿é€çš„å®è´¨æ˜¯åˆ©ç”¨[è·¯ç”±å™¨](https://baike.baidu.com/item/è·¯ç”±å™¨/108294)ä¸Šçš„NAT ç³»ç»Ÿã€‚NAT æ˜¯ä¸€ç§å°†ç§æœ‰ï¼ˆä¿ç•™ï¼‰åœ°å€è½¬åŒ–ä¸ºåˆæ³•IPåœ°å€çš„è½¬æ¢æŠ€æœ¯ï¼Œå®ƒè¢«å¹¿æ³›åº”ç”¨äºå„ç§ç±»å‹ Internet æ¥å…¥æ–¹å¼å’Œå„ç§ç±»å‹çš„ç½‘ç»œä¸­ã€‚NATå¯ä»¥å®Œæˆé‡ç”¨åœ°å€ï¼Œå¹¶ä¸”å¯¹äºå†…éƒ¨çš„ç½‘ç»œç»“æ„å¯ä»¥å®ç°å¯¹å¤–éšè”½ã€‚

> å†…ç½‘ç©¿é€èƒ½å¤Ÿä½¿ä»…å¯è¢«å†…ç½‘è®¿é—®çš„æœåŠ¡è¢«å…¬ç½‘ä¸Šçš„è®¾å¤‡è®¿é—®åˆ°ã€‚
>
> ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘éœ€è¦ä½¿ç”¨å­¦æ ¡å®éªŒå®¤çš„æœåŠ¡å™¨ï¼Œåªèƒ½é€šè¿‡ä½¿æˆ‘çš„ç”µè„‘è¿æ¥åˆ°å­¦æ ¡çš„ç½‘ç»œï¼ˆä¸æœåŠ¡å™¨å¤„äºåŒä¸€å±€åŸŸç½‘ï¼‰ï¼Œå†é€šè¿‡å±€åŸŸç½‘ä¸‹çš„ IP  åœ°å€ï¼ˆå†…ç½‘åœ°å€ï¼‰è®¿é—®æœåŠ¡å™¨ï¼›è€Œå½“æˆ‘çš„ç”µè„‘å’ŒæœåŠ¡å™¨ä¸å¤„äºåŒä¸€å±€åŸŸç½‘æ—¶ï¼Œæˆ‘ä¾¿æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ã€‚é€šè¿‡å†…ç½‘ç©¿é€çš„æ–¹å¼ï¼Œæˆ‘ä¾¿å¯ä»¥é€šè¿‡ä¸€äº›ä¸­ä»‹å°†æˆ‘çš„è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨ï¼Œè¾¾åˆ°å’ŒæœåŠ¡å™¨è¿‘ä¼¼å¤„äºåŒä¸€å±€åŸŸç½‘çš„æ•ˆæœã€‚
>
> å†ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æˆ‘çš„å®¶ä¸­æœ‰ä¸€å°ä¸»æœºä¸€ç›´å¼€æœºï¼Œç¡¬ç›˜ä¸Šå­˜æ”¾ç€ä¸€äº›å½±è§†èµ„æºã€‚ç”±äºé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ ISP åˆ†é…çš„éšæœº IP  åœ°å€ï¼Œå®¶ä¸­ä¸»æœºçš„ IP  åœ°å€ä¸å›ºå®šï¼Œåœ¨å¤–æˆ‘ä¹Ÿå°±æ— æ³•å’Œå®¶ä¸­çš„ä¸»æœºå»ºç«‹ç¨³å®šè”ç³»ï¼Œè·å–è¿™äº›å½±è§†èµ„æºã€‚è€Œé€šè¿‡å†…ç½‘ç©¿é€ï¼Œæˆ‘ä¾¿å¯ä»¥é€šè¿‡ä¸€äº›ä¸­ä»‹è¿›å…¥å®¶åº­å†…ç½‘ï¼Œè®¿é—®ç¡¬ç›˜èµ„æºï¼Œç”šè‡³å¯ä»¥å»ºç«‹ P2P è¿æ¥ã€‚

å› ä¸ºè‡ªå·±å†™çš„SpringBoot+Vue é¡¹ç›® è‚¯å®šä¸èƒ½åªåœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè·‘èµ·æ¥ï¼Œéœ€è¦çœŸçš„å…è®¸å¤–éƒ¨ç½‘ç»œä¹Ÿå¯ä»¥è®¿é—®åˆ°ã€‚æ¯”å¦‚æˆ‘çš„ç”µè„‘ä¸»æœºåœ¨Aåœ°ã€å‰ç«¯äº¤äº’åœ¨Båœ°ï¼Œé‚£ä¹ˆè‚¯å®šä¸èƒ½ä¾é å±€åŸŸç½‘WIFIæ¥é€šè®¯ã€‚

æ‰€ä»¥å†…ç½‘ç©¿é€å°±æ˜¯å®ç°å…è®¸å¤–éƒ¨è®¿é—®æœ¬åœ°ã€‚

##  å®ç°æŠ€æœ¯

æœ€å¤§ä½¬çš„å°±ngrok

- Frp è¿™ä¸ªæ˜¯æœ€å¼ºå¤§çš„ã€é«˜åº¦å¯è‡ªå®šä¹‰çš„
- é’‰é’‰å†…ç½‘ç©¿é€ æœ€ç®€å•çš„ï¼Œå¿«é€Ÿä¾¿æ· ä½†æ˜¯æœ‰å†…å­˜æ³„æ¼é£é™©+é™åˆ¶è¯¸å¤šã€å®¹æ˜“è¢«å°
- natapp...

##  æ•ˆæœå±•ç¤º

> Tunnel Status                 online                                                                                    Version                       1.7/1.7                                                                                   Forwarding                    http://xuptchatroom.vaiwan.com -> 127.0.0.1:8080                                          Forwarding                    https://xuptchatroom.vaiwan.com -> 127.0.0.1:8080                                         Web Interface                 127.0.0.1:4040

å°±æ˜¯   http://xuptchatroom.vaiwan.com  æˆåŠŸ æ˜ å°„åˆ°äº† 127.0.0.1:8080 ç«¯å£



# æ•°æ®åº“ 

2022\07\13

##  çº§è”æ“ä½œ

ä¹‹å‰è®¾ç½®ç”¨æˆ·å’Œç¾¤èŠå…³ç³»çš„æ—¶å€™ï¼Œè®¾ç½®äº†å¤šå¯¹å¤šçš„å¤–é”®ã€‚

å¦‚ä»Šæƒ³è§£æ•£ç¾¤èŠï¼Œå³ `Delete` æ“ä½œ ç›´æ¥æ“ä½œè‚¯å®šä¸è¡Œï¼Œè¿™è¾¹ä¸»è¡¨æ²¡äº†ï¼Œé‚£è¾¹å‰¯è¡¨å’‹åŠï¼Ÿ

æ‰€ä»¥éœ€è¦`çº§è”æ“ä½œ` ä¸»è¡¨åˆ é™¤çš„`id=1`çš„æ•°æ®ï¼Œé‚£ä¹ˆå‰¯è¡¨çš„å¯¹åº”æ•°æ®ä¹Ÿè‡ªåŠ¨æ²¡äº†

ä¾‹å¦‚ï¼š

è¿™ä¸ªç¾¤èŠæ²¡äº†ï¼Œé‚£ä¹ˆå¯¹åº”çš„ç¾¤èŠå…³ç³»ä¹Ÿéƒ½æ²¡äº†



CREATE TABLE `userroom` (
  `Phone` varchar(15) DEFAULT NULL,
  `roomId` tinyint NOT NULL,
  KEY `Phone` (`Phone`),
  KEY `roomId` (`roomId`),
  CONSTRAINT `userroom_ibfk_1` FOREIGN KEY (`Phone`) REFERENCES `usersinfo` (`Phone`),
  CONSTRAINT `userroom_ibfk_2` FOREIGN KEY (`roomId`) REFERENCES `room` (`roomId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3

##  å¼€/å…³å¤–é”®

```mysql
SET FOREIGN_KEY_CHECKS = 0;
DELETE FROM room WHERE roomId=1;
SET FOREIGN_KEY_CHECKS = 1;
```

æ”¶å¤–é”®å½±å“ï¼Œå¿…é¡»å…ˆå…³é—­å¤–é”®ç„¶åå†åˆ é™¤æ•´ä¸ªç¾¤èŠã€‚

##  å¤šæ¡sqlè¯­å¥

ä¸æ­¤åŒæ—¶å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ï¼šä»¥ä¸Šæ˜¯å¤šæ¡è¯­å¥ï¼Œå°±å¿…é¡»è¦åœ¨é…ç½®é‡Œå†™ä¸Š`å…è®¸mybatisä¸€æ¬¡æ€§æ“ä½œå¤šæ¡è¯­å¥`

```
spring.datasource.url=...&allowMultiQueries=true
```



##  IN å­æŸ¥è¯¢

æƒ³è¦å…ˆä»	`userroom` è¡¨ä¸­æŸ¥å‡ºä¸€ä¸ªç”¨æˆ·æœ‰å“ªäº›ç¾¤èŠã€ç„¶åå†æ‹¿å»`room` è¡¨ä¸­æŸ¥å®Œæ•´çš„roomå†…å®¹

åµŒå¥—æŸ¥è¯¢æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯ä¸èƒ½ç”¨ `=` ç®€å•è¿æ¥ï¼Œå› ä¸ºæŸ¥å‡ºæ¥è‚¯å®šæœ‰å¤šä¸ª`roomId` ï¼Œç­‰äºå·åªèƒ½ç”¨äºæŸ¥ä¸€ä¸ªã€‚

å¿…é¡»è¦ç”¨`in` 

> IN è¿ç®—ç¬¦ç”¨äº WHERE è¡¨è¾¾å¼ä¸­ï¼Œä»¥åˆ—è¡¨é¡¹çš„å½¢å¼æ”¯æŒå¤šä¸ªé€‰æ‹©ï¼Œè¯­æ³•å¦‚ä¸‹ 
>
> WHERE column IN (value1,value2,...)
> WHERE column NOT IN (value1,value2,...)



##  EXIST ALL

ç±»ä¼¼çš„è¿˜æœ‰existã€all æŸ¥è¯¢

##  å­—æ®µåä¸‹åˆ’çº¿é—®é¢˜

ä¹‹å‰`_id`å½“æˆå­—æ®µå ç»“æœä»mysqlé‡Œé¢æ€»æ˜¯æŸ¥ä¸å‡ºæ¥ã€éƒ½æ˜¯0ï¼Œè¿˜ä»¥ä¸ºæ˜¯æŸ¥è¯¢æ–¹å¼çš„é—®é¢˜ã€‚`mybatis-plus` ä¹Ÿä¸è¡Œï¼Œåæ¥æ”¹äº†å­—æ®µåä¸º`id`å°±å¥½äº†



#  å…³äºåŠ å¥½å‹/åŠ ç¾¤ åŒæ„åæ‰èƒ½æ‰§è¡Œ

ä¸€æ¬¡ç”³è¯·ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹å°±è¦ä¸€æ¬¡åŒæ„/åå¯¹

åŒæ„/æ‹’ç»çš„æ¶ˆæ¯å…¶å®åˆè¦è¿”å›å»ï¼Œæ¶ˆæ¯ä¸æ­¢ä¸€æ¬¡æ¥å›ã€‚

åˆ°åº•æ¶ˆæ¯é€šçŸ¥æ˜¯å’Œ`message` ä¸€è‡´	è¿˜æ˜¯æ€æ · éœ€è¦ç»Ÿä¸€

#  åŸºæœ¬åŠŸèƒ½æ”¶å°¾

2022.07.15

ä¸€ä¸ª ç®€æ˜“çš„èŠå¤©å®¤è½¯ä»¶çš„åŠŸèƒ½åŸºæœ¬åšå®Œäº†ï¼Œç§èŠç¾¤èŠã€å¢åˆ æ”¹æŸ¥ã€å¥½å‹ã€ç¾¤ç­‰

å½“ç„¶è¿˜æœ‰ä¸€ç‚¹å°éƒ¨åˆ†æ²¡å®Œå–„ï¼Œæ¯”å¦‚åŠ å¥½å‹çš„ç”³è¯·



å‰©ä¸‹çš„ç‚¹

1. åŠ å¥½å‹\åŠ ç¾¤ åŠŸèƒ½è¿˜æ²¡å®Œå–„

2. æˆ‘åº”è¯¥å¼€æ”¾æˆ‘æœåŠ¡å™¨ä¸»æœºçš„æŸä¸ªæ–‡ä»¶å¤¹ï¼Œä»¥ä¾›å®¢æˆ·ç«¯è·å–å›¾ç‰‡ã€è§†é¢‘ã€å£°éŸ³æ–‡ä»¶

3. ä»¥åŠå‰ç«¯éœ€æ±‚é‡Œé¢çš„  

   > 4.2.2 æœç´¢ç”¨æˆ·æˆ–è€…ç¾¤èŠ

   æˆ‘æ²¡çœ‹æ‡‚...æ‰€ä»¥éœ€è¦å’¨è¯¢å‰ç«¯æ‰èƒ½åš

4.  

5. 



#  

#  åç»­ +Netty+Nginx

ä¸€ä¸ªé¡¹ç›®å¤§éƒ¨åˆ†éƒ½æ˜¯SpringBoot + Mybatis +WebSocketä¹Ÿå°±å‰æœŸç¼“å­˜æœ‰ä¸€ç‚¹ç”¨	`Redis`  

æ„Ÿè§‰æŠ€æœ¯æ ˆç”¨çš„è¿˜æ˜¯å¤ªå°‘äº†ï¼Œåç»­æƒ³å¤åˆ¶ä¸€ä»½è¯¥é¡¹ç›®ï¼Œæ”¹é€ ä¸€ä¸‹ï¼ŒæŠŠ	`Netty`åŠ è¿›å»ï¼Œç”šè‡³äº`Nginx` éƒ½å¸Œæœ›å¯ä»¥ç”¨ä¸Š
